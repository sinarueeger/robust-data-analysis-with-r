---
title: "Meteorite report"
author: <Your Name>
date: "2019-09-07 (updated: `r Sys.Date()`)" 
output: 
  html_document:
    toc: true
    toc_float:
      collapsed: false
      smooth_scroll: false
    number_sections: true
    highlight: tango

---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


Put it in context with the data analysis workflow. 

# Import data


```{r}
download.file(
  "https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2019/2019-06-11/meteorites.csv", 
  "~/tmp/meteorites.csv")

dat_raw <- readr::read_csv("~/tmp/meteorites.csv")

```
# Tidy data

Done


# Transform data

```{r}
dat <- dat_raw %>% 
## 1) Remove rows that have year as NA
  filter(!is.na(year)) %>%
## 2) remove name_type Relict cases
  filter(name_type != "Relict") %>%
## 3) remove mass min
  filter(mass > 0) %>%
## 4) remove years with more than 2019
  filter(year <= 2019) %>%
## 5) create a variable century
  mutate(century = cut(year, c(0, 1900, 2019)))


```

# Descriptive analysis

```{r}
skimr::skim(dat) %>% 
  skimr::kable(format = 'html', booktabs = T) %>% 
  kableExtra::kable_styling(font_size = 9)

```


## Histogram

ggplot(data = dat) + geom_histogram(aes(year))

## Scatterplot

ggplot(data = dat) + geom_point(aes(year, mass))



## Map

```{r fig.height=7, fig.width=7}
library(ggplot2)
ggplot(data = dat) + geom_point(aes(long, lat))

ggplot(data = dat) + geom_point(aes(long, lat)) + facet_wrap(~ century)
```



```{r fig.height=7, fig.width=7}

library(ggplot2)
library(dplyr)
require(maps)
require(viridis)
theme_set(
  theme_void()
  )

## basic
world_map <- map_data("world")
ggplot() +
  geom_polygon(data = world_map, aes(x = long, y = lat, group = group), fill="lightgray", colour = "white") + 
  geom_point(data = meteorites, aes(long, lat), color="red", alpha=0.5)
```

Color as year
```{r fig.height=7, fig.width=7}

## color as year
world_map <- map_data("world")
ggplot() +
  geom_polygon(data = world_map, aes(x = long, y = lat, group = group), fill="lightgray", colour = "white") + 
  geom_point(data = meteorites, aes(long, lat, color = year), alpha=0.5)
```

Animation
```{r fig.height=7, fig.width=7}

## make an annimation
library(gganimate)
world_map <- map_data("world")
ggplot(data = meteorites) +
  geom_polygon(data = world_map, aes(x = long, y = lat, group = group), fill="lightgray", colour = "white") + 
  geom_point(data = meteorites, aes(long, lat), color="red", alpha=0.5) + 
  transition_manual(year)  +
  labs(title = "Date: {frame}") +
  NULL

```




# Model

Fit a prediction model that takes year, location and mass into account

# Export

Store transformed data

```{r}
#as xlsx

#library(xlsx)
#write.xlsx(data_sm, file = glue::glue("{DIR_DESCRIPT}/ms_tables.xlsx"),
##           sheetName = "Table 1 (data summary)", append = FALSE, showNA=FALSE, row.names = FALSE) 
#write.xlsx(res_sm, file = glue::glue("{DIR_DESCRIPT}/ms_tables.xlsx"),
#           sheetName = "Table 2 (results summary)", append = TRUE, showNA=FALSE, row.names = FALSE)

## as text file
readr::write_table2(dat, path = "~/tmp/meteorites_transformed.csv")

## as Excel file
library( writexl)
?write_xlsx
write_xlsx(dat, path = "~/tmp/meteorites_transformed.xlsx")

```

# Task

- change title
- export as pdf/word/markdown
- 

## Extra

- Look into xaringan and CSS file
- code download button: https://twitter.com/apreshill/status/1108925218850893832


# More infos

- https://rmd4sci.njtierney.com/
- rmarkdown: https://holtzy.github.io/Pimp-my-rmd/

